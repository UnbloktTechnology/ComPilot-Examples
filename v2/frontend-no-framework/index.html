<html>

<head>
  <title>Nexera: no frontend, no framework demo</title>
  <script type="importmap">
      {
        "imports": {
          "@nexeraid/web-sdk": "https://esm.sh/@nexeraid/web-sdk"
        }
      }
    </script>
  <script>
    var nexeraIdConfig;
    var onclick;
  </script>
  <script type="module">
    import {
      openWidget,
      watchWidgetVisibleState,
      createAuthAdapter,
      createConfig,
    } from "@nexeraid/web-sdk";

    nexeraIdConfig = createConfig({
      authAdapter: createAuthAdapter({
        // This is an implementation of the auth adapter
        createSession: async () => {
          try {
            // Make a POST request to your API endpoint, previously created with wit nexera js-sdk, considering you created the path api/create-nexera-session.
            const response = await fetch('yourApiUrl/api/create-nexera-session', {
              method: 'POST', // HTTP method POST
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({}),
            });

            // Check if the response is okay (status in the range 200-299)
            if (!response.ok) {
              throw new Error('Network response was not ok');
            }
            // Parse the response JSON
            const data = await response.json();
            // Process the response as needed
            console.log('Session created:', data);
            return data; // Return the data or any other necessary information
          } catch (error) {
            // Handle errors
            console.error('There was a problem with the fetch operation:', error);
            alert('There was a problem creating the session.');
          }
        },
      }),
    });

    watchWidgetVisibleState(nexeraIdConfig, {
      onChange: (isVisible) => {
        alert("Widget changed visibility. Is visible: ", isVisible);
      },
    });

    onclick = () => {
      alert("Opening widget");
      openWidget(nexeraIdConfig);
    };
  </script>
</head>

<body>
  <button onclick="onclick">Open widget</button>
</body>

</html>