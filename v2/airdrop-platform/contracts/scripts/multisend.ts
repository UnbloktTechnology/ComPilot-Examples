import * as fs from 'fs'
import { createPublicClient, createWalletClient, encodeFunctionData, Hex, http } from 'viem'
import { privateKeyToAccount } from 'viem/accounts'
import { polygonAmoy } from 'viem/chains'

const accountPk = process.env.PK_HEX as Hex
const account = privateKeyToAccount(accountPk)
const transport = http()
const publicClient = createPublicClient({
  chain: polygonAmoy,
  transport,
})
const walletClient = createWalletClient({
  chain: polygonAmoy,
  transport,
  account,
})

const MultiSendAbi = [
  {
    inputs: [
      { internalType: 'uint256', name: 'amountPerAddy', type: 'uint256' },
      { internalType: 'address[]', name: 'recipients', type: 'address[]' },
    ],
    name: 'multisend',
    outputs: [],
    stateMutability: 'payable',
    type: 'function',
  },
  { stateMutability: 'payable', type: 'receive' },
] as const
const MultisendAddress = '0xba43f0abc31dbf9a7c1ff2a9e531ccff8bf3c86b'
const addresses: Hex[] = [
  '0x249D43960cAeC57b1e975449bA8bD44814b5834D',
  '0xa301A33D4f40Ad88bbA7538AEE6EE93d3E52Cb9C',
  '0xfBA989108be85751Ac9AC3cE11357ce39C2A9AD5',
  '0x0B2398E56ec685C2114F8004D9411eAA095c344B',
  '0x870428A540fa56f1B61CBC85543968A45Ef3D158',
  '0x8C11D91f28F140F1681Bf5A98e69EcD50bed2D10',
  '0xCD22038619454308d4948786CAAE58F8C92Cb908',
  '0x3e4a95006553610651068ECD30701fA0097BC923',
  '0xE4970bCcb180c5AA112d0559dF492040a767DA6c',
  '0xF62b6d5bbDa63016C77FA21168F9115d0132acCb',
  '0x3a00a6F9B80e5eEE7bcE76c3C77FF8262d8a7240',
  '0x18a20A77e53c9ebb4f08F029A4609bD6e946F060',
  '0x1E2B952a11a1542722a349b9478fd9e1f5e93397',
  '0x12AF256f21Ed13EA96cadf0aa9B0D2624B8cf963',
  '0x9BDb543b6cAb4AE77D2AA5149c28917Dcc4000A6',
  '0x7d64d88C2AFc8fADeDc05EE93d25bD29f9C05Be1',
  '0x7455448Ec45d7A469785478C8b7197b54c499Ba0',
  '0xE63c21d06437786e35Eb7E104DB5A77A766C8719',
  '0xB49841d8484578A6B8DA60c7A3ADD974509Fbd33',
  '0xbfd2D54ae8CafD3141a444058Fbb698970d7F754',
  '0x74C370f3C33FE7fBA4a7EB62b6A16bbB9D6eb74C',
  '0xD4Bfd94b4Fd02a371026d02726923D1b44A5f4f5',
  '0x86aabadDAa8Ddf02D67941e74450a70A3095DB64',
  '0x466Bd9881B324218Fe5FA61AB3Aaf6AaD3BBbde5',
  '0xf523804d92236cc4eC7CCE0D1dcB554B4f4E64a8',
  '0x122dac2Ee8856C9962f5F8Eb9195f2b77BAa93f7',
  '0x31bFB6DeAb252085ca8DB07A60b2e4F9AE5017F0',
  '0xAf0B7dd6d635158a41c45B1DE23FA8E2d94210A9',
  '0x5E3dbDeCBa41574e6Edf0128770BBc3bfd0A77a8',
  '0x41Ae38210af5543C8FD48E397bCc29188FfE4046',
  '0x21413C6FC921Bcd078C7535502653734cD968166',
  '0x61fcE9fd2efaB163356E187Cb3A3786C07C3Df08',
  '0x93529d381B096e13935166B408EE0F00B9A32E70',
  '0xe090d28d273cD3756B56C4D896ebA050E14bc7e0',
  '0x81de2393A9Bb9E006a36f8F6f62b318564C6b724',
  '0x6042D4a33413Df0b661E8069f939696e11906E74',
  '0xC12815b9b6a37bdA3C0152b976C80965D04eAf3F',
  '0x614B4751c38798284ACd95bdD8Ae34E405aA61de',
  '0xa5c86c65185ADdEF7D33797E340845e9e53b4194',
  '0x2a7A0B4ce87E36D7A2199EDe7f66C68DfabeD02e',
  '0xFEd026fED46301070142cC46af4E5cf4884C8F8a',
  '0x7F8385c2a64EFdC4736dA2A3AffB97bA97BDFaE8',
  '0x1FC3c0Cfc866738F3835DF54B4200cC327846c80',
  '0x5560fe74A3CBc25317dFc8bBCB22810D02a9B7cC',
  '0x67CBecd255298588CF06677DC54e61bbdEf44634',
  '0x7aBF51b4065a87b00ffFA5619aeC1Cd0589E5CE7',
  '0x732978433E68e2ad9a083099623e483aaf3C83f9',
  '0x261BF68a1B8792BBe4173F9D41A612249Ebf5B38',
  '0x35a5D1ACe9a87312f2E76397Ac3A5A6fD13531CF',
  '0x29d44c1cA0EF199Ada12Ab98D2A3a93B6EEA9e89',
  '0x7c65F97847941CA1A3E7A58B517009004648770a',
  '0x5708F8A61c41dA7b8C208C3700f3f853270Bb897',
  '0xc1d6BDFb3114B8E8F6A9Be9eb70515B45056EE40',
  '0x95690B4e39f8D76C322902ABBfd9a9C3C196398c',
  '0x57B589640436B86a60569D69065aA7A713c35162',
  '0x63a3120667feA743ad1E5AD102908775bc7c3E01',
  '0xB959934607796bD21159503eE82F434Acae29B77',
  '0x4Aa14D533f02f734369a3Aa806d87830107765d9',
  '0xAFf7294eb2F8C7b84bb1F644234Ef1E949Ae728b',
  '0xB3049507e4E405a2Fb498A20238A10B8e873Ea38',
  '0xF6bF2221cFf37aEdF7139E75A868f6f383FDC52D',
  '0x23E0b1A58a620F14647bb1B147d010eEA6C57955',
  '0x3F21092F7F8c623866dD12AAAAc3e7622CA36fBE',
  '0x2a013F97A76e4a3472c61aE17f81F20770294231',
  '0x5cB64Ba59037B28f6079B532F2986b69891e5F79',
  '0x6faE40b2850a4B9d41BEa145299f09e89685052A',
  '0xa98E2873B45D000F6850ce59d72767f82EfC8d26',
  '0xaBec71a5df008b9b89f28f1b2B2C2979C5b4a031',
  '0xA6edcA2feDecDF3aEd2972a13752fE60A7c3Ceb5',
  '0x5AA275825B144D9B36f2345Fd004BA059f335711',
  '0xA10CCb05D4dAa2D1D2bA05d24cFf5D410883CB77',
  '0x093975ff54eE902cf3C885eD815Df629341C2EAc',
  '0x1c0D3D0402bEb29F574569Dd95ae8cC417B2043B',
  '0x748057e1814166ce135adf5eBE87E22149455902',
  '0xE3b61544bF7d5718220190AefA73522950A86834',
  '0x6714b3b988708F0C1dd4a66536F6A99e8317AA4D',
  '0x5E8279980C54e2260480ED8aF618DA81e42A45Dd',
  '0x7992f5FbEB1cC1BFf7b30e12Aa1BFE13eA7B2034',
  '0x4c894cFA0304e54ff83Bd5e7582b8BdA5Feb50F1',
  '0x973eE0C8468140845f66F0295102D27C003d5D67',
  '0x5560A5427aC5d5e951CfE9855E743fc4f67CD64e',
  '0x808934Fd8e9Bb8f523EAcdEBFFd13D8FF1240165',
  '0x9400A241D3ab789AEA45B88565fb0A54E094bA5A',
  '0x8ed7CC8fB5DD94842a38e36b0a9CCadBF8e8a899',
  '0x5cB9dB773272c6A20E31b489Bd7b731500701A85',
  '0xB62fcf6A51dC9Cd1cda1D045380ab53Dd6010D40',
  '0xfAbAAb2206758cE591065C3548BE379E1Fc6913f',
  '0xF1314429D45B140043Bb691a350473479298E7fD',
  '0x4eE19aea059a36b51f4ACd36816CE8aA33cF5Ad7',
  '0x042bC7f28DB37c5C3a13Ba25DBd73A92E951d7E2',
  '0x829dd53881b0efC21a8caa6f3189C45f21489921',
  '0xAd5c027379174a6CE4c37F7D8E538bD58680DB72',
  '0xeFF50aF7D1fA75B6a8FFa72FC981c2a6478DC82d',
  '0x5E8f6D5326C6458397273274F9c4208db75713a4',
  '0x565ad423143a701Edd39299f1a3D9261e43fa834',
  '0xB3a5103E4520485E80A4F8E14779201f17be297D',
  '0xAAD96bEDC7ab41aEFA7E3AC9fbfBbCEE54Fb2Ce8',
  '0x5776978eCf37629512a57145eCA9c975fD971dcA',
  '0xbEF2782630d63f4B8543a17aBCCFC03472D34931',
  '0xa4F1cb3F6DF2cebB40Cb5209Ec4bAcAed69ca9d0',
  '0x3Cb379096072bA3cDf43D161F00dc588661Eb0Ff',
  '0x6314478B4571932Ee052757A8614c3485b16B83F',
  '0xb2fa30f1736bdd0a282772f46b39e15206c6a9be',
  '0xbea25a41f9f6b5bd9a3ad666cdabfe0a201033cf',
  '0xfba12dfe760ea9ca98cf7e494921cfaa461f4435',
  '0x57e133642fb4aa81a470110a2ba0130582f6a65f',
  '0xad1b07cfdd391a5e446afb9d1b72d3f8e9fccc4a',
  '0x25ae9e5ce622563628e96a8d66e59364af8671d9',
  '0xfb2fcc3c058c018e43efe5b4b0fc349a5255608a',
  '0xa06e062a9a213c959e1ac5d92c6d9b657d3ef5c5',
  '0x86a2dbc96275f09e8fe95c9914c513c071489b9d',
  '0x688c6b76daa2b8727FddB8B2eAfe5E4dEa7a4166',
  '0xABa689B5658A78cB4fb64612e9f863af65F2CD31',
  '0x8C5f4C06431448385fC12e076F4AFA4Ab28d933B',
  '0x3a8A86F7caDF771C6A7F4b6AF4607A57B522D96A',
  '0xA1D57b6DE4b9F497C06861D212007A525A2A8914',
  '0x8444cD1e115d6c9A747E4151036cfBDb128837dC',
  '0xFa90999A2673E1014A0906EEEc094A961C3905E3',
  '0xF3E94FC9585b67889Eb911855E3c4941Ea82385B',
  '0x7294D2798c02c157F4d56aEb0fbA5bAd6459e72d',
  '0x9A2aC34Cfa787220b521Ac1635e912b249d6D44E',
  '0xd348befb3a3da6e5ad46e5149540c4a41d46ce2e',
  '0x4f2f0e0873ccb24616fed58b39ee027c1c9e9c21',
  '0xfa69a224819302e7ae61d70aacae7110509e0e1e',
  '0x0f41545eba676ba7a8c4e1215ab5136400fddb53',
  '0x22a8784e1cf883ba8d30b24c4af52c59236b4dc2',
  '0xa99c01fd9f1cef770ccd0afbf85f1b6373047b72',
  '0x687a71aab13473f0ef0e6413661bd1ee787c4a36',
  '0x172073cfc182f762e50757bfab2f9bac3de8675b',
  '0x2a1c80b48ae0093970a8fa78b27f44b35720593e',
  '0xbd8d878a5fff7acc604d777501339c457872056a',
  '0x13455eb4dd45a91e70e90e8e1148ee04e03a08d9',
  '0x43a0ce945d5f51d8846b236f6998f2d3264bd555',
  '0x885aa9616678b2622ee6c6a2628ed8c2b29e7484',
  '0xfb6513f3bff2931c9c9a3e517cd99a2a1ab64f27',
  '0x235b692cc04fa086b3a037cc862a4c69856c6907',
  '0x00a9134cdbffd57c56a9f441c3f85084a41bd1b0',
  '0x8e513ecd1c2c04b84825f5359538f14cc7e50996',
  '0x5d06d455ee34a20b3f1d88d6af7e8b6febb9a18b',
  '0x4c5d1766b2593c493402832f656e3511ca2043e1',
  '0x87747cfd5c4f363572dbeaa82c418d6102dce204',
  '0x81d786b35f3EA2F39Aa17cb18d9772E4EcD97206',
  '0xb01DB4A1AF9bA5001676Fc60f05D1833746f2460',
  '0x74aAEBd50eF51dA9FCa10fD00528D241E63b1B0c',
  '0x46A3223eb615205aB6D9F2B8105c27F3384E97e6',
  '0x67156c39a67a99Fbe4B59EF66ECfB798c60B9C23',
  '0xE1183d9F6160eA70fd853e76043Afd0DE95F191e',
  '0x9a969487017Ee61C29F56a23a550e1bC6088bEfb',
  '0xB812502693bDF7a2D2008702cFf54Ebe9dE1d3FE',
  '0x8a59DaAD8fFcca5766a0d3e397aE787834837836',
  '0x682E956a0F3ADA2190a68Ac134CC3Ae6f0000552',
  '0xe2B7fCB3763335F0349e044e47950448b923789C',
  '0x217dE86B7a0F3Af7CAeCc586707De7e570B6B889',
  '0x48353d8cc75FCDd5a03953456bF91f6D76067357',
  '0x1F93BcFB00767F4F8fd1A7b4bEBAF66b1EcB4fd5',
  '0xa70f6BB5c98CF34ad12A13bFf2E43a5c2a97DBFa',
  '0x8EF25Ff47E4A9E33CD42945dCE86Ab50A49e7cE0',
  '0x8D443848072636f06bc7B288ff61069184421aEe',
  '0x92b772DF12a132D7Bf226e6F36287babDb81415e',
  '0xA2D1dD678308EA9dFb7368bF235e0fF9c0286877',
  '0x8b787C9FCbe5559716080C71F35b2d6F3e592157',
  '0x62a6AF5415d8B1E2e26Aea0Ea5081B77df436930',
  '0x227E1F6af0907DA600d34307461Cff22F93CBB84',
  '0x6eC7B87B8fa2AfA2364be1868600a40A6fDc7926',
  '0xD7c1b9A7EDC5c6cD7b19C0C119FDF18f778f07a6',
  '0x88a3ad3C1b663cbABd788631D7Fa23AC832dFA8B',
  '0xd02c11ac6749859521F976F1DbB29Dc0A405cCA0',
  '0x09aF4b8A2b57AfF3018e7834B62e0517bb411B9c',
  '0xC997A3a8C299F06322328c2A1dB814400EA876f9',
  '0xf1Fa00666462F2a3dA859e925314e48fF9929626',
  '0x4756B1821FBEF402d84DB4427c08fE1c53C04069',
  '0xdf4d40bc6ba80647295e834dbf0a9f6282ac9a30',
  '0xecce164451bf1f0660f9ce8d685f55329b7e258b',
  '0x0ba38c2e4fda246689669a2b7b44391bf604d69e',
  '0x8eab7e4c770a5b60af8e0110ad40fe82ca073cab',
  '0xe41a350e115e4471a3465c43a011c4b8ab8e30ad',
  '0x4d7959c4578e93714b0a604a23369acac48cbc2b',
  '0x4117eb5029715552c171e3848819d8674cb6c88e',
  '0x248c087ca00fe4cb2d8e80c4d39feeab11838d0c',
  '0x9fc185c065390d38943d96378681c8fe927a91d6',
  '0xc464497546f6985737865dd70f5721f0ec5b5772',
  '0x1ddd92585bfbf79052ee01b7fb781960c08cf6ac',
  '0x7cedcafa4afe0e221927c2049648b69d09e6a0eb',
  '0x675f5e3606f9b3d8d6832eaaca0f940ddf587959',
  '0x7def1f5044ed5d2eca5f29342ea8a331ef0fde9d',
  '0xae4a29308787e22a63a500dbda61e5f0b07cdc86',
  '0x09e54fe46ee7e2c440552c6d9ff0ff3f413251e1',
  '0x7010443c261f3b2a09a3480ddd283f7c826c76e2',
  '0x731c0e1e93d4adfa650a6387befaa454f0ce5288',
  '0x6a0708b8127c32f641f1a79dde4b163649a6be79',
  '0xcbcce72af280aaec6837d4027c32c2556961ec6d',
  '0x6abe944F70712f29b5Ce5C5AEe2404bAB9c2057C',
  '0x305325021c3eDEb1007a40b99BeC15e109DBa502',
  '0xAa249057CE1312B91ff826B8379A142430f29220',
  '0x2716dcc8738FAD504c1Ef4Db6effb02f3bAFf082',
  '0xF778bCA5448cc2eF885E0e79f42d1b8d50e36010',
  '0xbD2Ba5301d178f8aDb20b6B512D3aF21E9a7Eaa6',
  '0x77DA0df7930242D245a8F89Df8d056721F539f8b',
  '0xEe8CB775820f72F6C297c569535a9ef85f28448a',
  '0x06911596Edadc6eb170c377A89A7B2E7B4C7C28B',
  '0xA0234F94ACc5066659762629D7F11B4bBcE0e5B8',
  '0xDA4f0B28A0860494678aC6b497Af7598Da5A0620',
  '0x3b08C67eB8B2Dcc06c92Ba397c5e7313E898aB87',
  '0x42216547a592F30287Ee8aa7E59FcCB632C52d81',
  '0xe2925aAd8B32c71eb5c403E484F3c4C434465BbE',
  '0x9cdA49EC45E1452d1cFc24BdF7fDCb44D76Dac5E',
  '0xe9D202CdaC895150Ce1621DC911e71A7960F22AC',
  '0xA481140879EBe5c53AB1B450B916606543a87eF6',
  '0x603E366D634742Deeb113bB3ed73d2e357903b6D',
  '0xC06DD6C11F3a77aC9848cb1b3d2f45F9177c4D7C',
  '0x2CB06631A0cc44D2aaf8f40F492f277F480792bE',
  '0x4179cc50251E527F3Eca36c609AD682C21c2c011',
  '0x60c688192966e240A1854cfc62c205660FbbFa2f',
  '0xd790c6278060DaA19B3CFfb65dff14e6c4377fE6',
  '0x5452ac575637dB66Da2A2515FEcB22EB33453271',
  '0xD66B00eA2122fa5E3cd9aaB47448879e2929044d',
  '0xF41D831d001880cC9bfd54bC67444DfAac1291E5',
  '0x10249F3275B35D9501c22264502c1C12C1E7316B',
  '0x31e3958e26745093027829b3bcAB186E8b962945',
  '0xA83EdfFE69D7648ab46e2dE770C9B30043f55418',
  '0x78F7892c7848DC5910C9f052eC7e79F4151899d6',
  '0x424D819Ef1dFC225524bE8f99a44c514B7E9fC5B',
  '0xCdC067a061B88dfe77ACc9F2A505eb093f9575e7',
  '0x1cBF62AC955056d47a5271643674f768C28b3a2F',
  '0xA555964FA27622D5A45e9ce826692032D4Aa8760',
  '0x23D55347749B56942F422887D21de43740492Ad3',
  '0xb1f99cebb77520e7f75D5D02605aA9E5E0b6928b',
  '0x75c5D4d63C3Be3E2F52caF101aB5D2e274443B9F',
  '0x090b189902FA1851844934923288c275D662C5B4',
  '0x90723015a26e16Ec0aD3151E6373fFeb703ca744',
  '0x2fEe6558Da16B2dF68a7156e3AA4117dB09282CD',
  '0xD13F79C516ca194e5DdEfcec75bf47F27f25E862',
  '0x3a5096e624CfAAaA2FeEfC22f1f9d9eb82e1EF86',
  '0x99Bf91144fd3589585AaDA64479A81cd208C0842',
  '0xD57c073c121098542890B60b431Ce4314dC97018',
  '0x116c1E40A2c60B23f03a9B678E54b716F4B45468',
  '0x537879eaC05F5C84298475AF862228De5236F87e',
  '0xe7d6A0790ef42A832a11B9Fb166339b43E6dC932',
  '0xe2349523Bb04F0F3E23d313c2009702e2779C365',
  '0xbAd14CF203d2A1e49c4adD944C01ceee13F9B242',
  '0xe0f5b0421C4D77259D2Dd4d16E0A35DA9912057a',
  '0xb05250110108235d87a435eE2a81D326c0Ea5077',
  '0xC814c006dd2096645011B923deE7c0Abe2784cb5',
  '0x0aD76AF2a31Fa915Cd41d416F3121F4F25435018',
  '0x07F58c1b5C58cC9F6B1C667A39E1F32e62e521e1',
]

// send the transactions and remember which pack failed / succeeded
const stateFilePath = 'state.json'

/* address => ok/ko */
type State = Record<string, 'success' | 'reverted'>

async function main() {
  const state = (fs.existsSync(stateFilePath) ? JSON.parse(fs.readFileSync(stateFilePath, 'utf-8')) : {}) as State
  // make packs of 20 addresses
  const remainingAddresses = addresses.filter((address) => !state[address] || state[address] === 'reverted')
  const packs: Hex[][] = []
  for (let i = 0; i < remainingAddresses.length; i += 20) {
    packs.push(remainingAddresses.slice(i, i + 20))
  }
  const weiAmountPerPerson = 500000000000000000n

  for (const pack of packs) {
    const data = encodeFunctionData({
      abi: MultiSendAbi,
      functionName: 'multisend',
      args: [weiAmountPerPerson, pack],
    })
    const txHash = await walletClient.sendTransaction({
      to: MultisendAddress,
      value: BigInt(pack.length) * weiAmountPerPerson,
      data: data,
    })

    const receipt = await publicClient.waitForTransactionReceipt({ hash: txHash })
    console.log(`tx ${txHash} status: ${receipt.status}`)

    for (const address of pack) {
      state[address] = receipt.status
    }
    fs.writeFileSync(stateFilePath, JSON.stringify(state, null, 2))
  }
}

await main()
